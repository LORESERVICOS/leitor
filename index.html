<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Leitor de Código de Barras</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
  <h2>Leitor de Código de Barras</h2>
  <div id="camera" style="width:300px;height:200px;border:1px solid black;"></div>
  <p><b>Código Lido:</b> <span id="codigo"></span></p>

  <label>Quantidade:</label>
  <input type="number" id="quantidade" value="1"><br><br>

  <button onclick="enviarDados()">Enviar</button>

  <script>
    let codigoLido = "";

    Quagga.init({
      inputStream: {
        type: "LiveStream",
        target: document.querySelector('#camera')
      },
      decoder: { readers: ["ean_reader", "code128_reader"] }
    }, function(err) {
      if (err) { console.log(err); return }
      Quagga.start();
    });

    Quagga.onDetected(function(data) {
      codigoLido = data.codeResult.code;
      document.getElementById("codigo").innerText = codigoLido;
      Quagga.stop(); // para não ler várias vezes seguidas
    });

    function enviarDados() {
      if (!codigoLido) {
        alert("Escaneie um código de barras primeiro!");
        return;
      }
      const quantidade = document.getElementById("quantidade").value;
      const url = "https://script.google.com/macros/s/AKfycbz_XqyJWgmNIAoUm37brJ-EJUt4QxNtFNmLi2GsgpM5jimiGPRZuaCS3SQbhXe9PyjZDg/exec"; // substitua pelo link do Google App Script
      fetch(url, {
        method: "POST",
        body: JSON.stringify({ codigo: codigoLido, quantidade: quantidade })
      })
      .then(r => r.text())
      .then(r => {
        alert("Dados enviados com sucesso!");
        location.reload(); // reinicia a câmera para próxima leitura
      });
    }
  </script>
</body>
</html>